# The 'version' tag is obsolete and can be removed.

services:
  cloudflared-dns:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared-dns
    network_mode: host
    restart: unless-stopped
    command: proxy-dns --address 0.0.0.0 --port 5053 --upstream https://dns9.quad9.net/dns-query
    # THE FAULTY HEALTHCHECK HAS BEEN REMOVED.

  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    network_mode: host
    environment:
      TZ: 'Australia/Adelaide'
      FTLCONF_webserver_api_password: 'qwertylll2' # Use your actual password
      FTLCONF_dns_listeningMode: 'all'
    volumes:
      - './etc-pihole:/etc/pihole'
    cap_add:
      - NET_ADMIN
      - SYS_TIME
      - SYS_NICE
    restart: unless-stopped
    depends_on:
      cloudflared-dns:
        # THE CONDITION IS NOW SIMPLER AND MORE ROBUST.
        condition: service_started